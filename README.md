# Dynamic-Stock-Recommendation-Machine_Learning

## Introduction:
We introduce a scheme to buy and hold top 20% stocks dynamically that outperforms the long-only strategy on the S&P 500 index.
Overview of Project steps:
+1. Data Processing
+2. Applying five ML algorithms
+3. Choosing the best models with lowest MSE
+4. Test with three portfolio allocation methods

## The proposed scheme:
A. Rolling window based data separation (training-testing-trading):
The training period is from 16 quarters to 40 quarters, followed by a 2-month lag. The testing period is 4-quarter long, followed by another 2-month lag. Finally, the trade period is 1 quarter.

B. Data Preprocessing:
The dataset is obtained from Wharton Research Data Services and is between 1 Jun 1990 and 1 Jun 2017.
We first removed outlier records (about 0.84%). Then the dataset is divided into three periods (to preserve a long-enough out-of-sample period for back-testing). 20 most popular financial ratios are calculated from the raw data. The dataset is also split into 11 GICS sectors. Finally, missing data (around 7%) are removed from the dataset.

## Methodology:
Linear Machine learning methods:
+1. Linear Regression
+2. Forward stepwise linear regression
+3. Regularized ridge linear regression

Non-linear machine learning methods: 
A. Random Forest
B. Generalized Boosted Regression model (GBM)
Implemented in ml_model.py








## Implementation: 
Step 1. Train and test the model to get the MSE for each of the five models. 
Step 2. Choose the model that has the lowest MSE in that certain period.
Step 3. Use the predicted return in the selected model to pick up top 20% stocks from each sector.
Step 4. We check on the models features and its coefficients or importance level to ensure that there are no abnormal results.

Python Script: 2 Scripts
*ml_model.py: The forecasting function (cornerstone of this project)
*fundamental_run_model.py: The main function to run the forecasting model
python3 fundamental_run_model.py \
  -sector_name sector10 \
  -fundamental Data/fundamental_final_table.xlsx \
  -sector Data/1-focasting_data/sector10_clean.xlsx 


## Portfolio allocation:
As for the portfolio allocation, we use mean-variance and minimum-variance constraints to allocate the stocks we chose before appropriately. (fundamental_portfolio.ipynb)

 

Input: 2 files

The CSV file generated by forecasting model

The adjusted close price data of S&P 500 stocks to calculate covariance matrix 

 

Output: 3 Excel files each with the following 4 columns

tic: the stock name

predicted_return: predicted return of next quarter by our model

weights: the weights to trade

trade_date: the date to execute the trades






